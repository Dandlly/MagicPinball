{"version":3,"sources":["assets\\script\\popup\\TurnTable.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { utils } from \"../common/Utils\";\r\nimport { user } from \"../common/User\";\r\nimport { events } from \"../common/Events\";\r\nimport { GameEvents } from \"../common/EventConstants\";\r\nimport { PopUpName } from \"../common/PopupConstants\";\r\nimport { AudioName } from \"../common/AudioConstands\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n/**\r\n * 轮盘\r\n */\r\n@ccclass\r\nexport default class TurnTable extends cc.Component {\r\n    @property(cc.SpriteFrame)\r\n    iconSpriteFrame: cc.SpriteFrame[] = []// 更换ap gp\r\n\r\n    @property(cc.Node)\r\n    iconNode: cc.Node = null;  //  节点\r\n\r\n    @property(cc.Node)\r\n    spinNode: cc.Node = null;  //  节点\r\n\r\n    @property(cc.Node)\r\n    closeNode: cc.Node = null;  //  节点\r\n\r\n    private _data: Array<any> = null\r\n    private _awardArr: any = null;\r\n    private isStart: boolean = false;\r\n\r\n    onEnable() {\r\n        this.closeNode.active = true;\r\n        this.spinNode.angle = 0;\r\n        this._awardArr = user.getLumpData().spinAward;\r\n        this.isStart = false;\r\n        \r\n        for (let i = 0; i < this._awardArr.length; i++) {\r\n            if (this.spinNode.children[i + 1].getChildByName(\"New Label\")) {\r\n                this.spinNode.children[i + 1].getChildByName(\"New Label\").getComponent(cc.Label).string = this._awardArr[i].award;\r\n            }\r\n        }\r\n\r\n        if (cc.sys.os == cc.sys.OS_IOS) {\r\n            this.iconNode.getComponent(cc.Sprite).spriteFrame = this.iconSpriteFrame[1];\r\n        } else {\r\n            this.iconNode.getComponent(cc.Sprite).spriteFrame = this.iconSpriteFrame[0];\r\n        }\r\n\r\n\r\n    }\r\n\r\n    /**\r\n     * 转盘旋转 （按钮）\r\n     */\r\n    turnAngleHandle() {\r\n        if (this.isStart) {\r\n            FSDK.showToast('The spin is starting');\r\n            return;\r\n        }\r\n        if (!cc.sys.isNative || user.getLumpData().isDebug) {\r\n            this.getAwardFun();\r\n            return;\r\n        }\r\n\r\n        if (user.getSpinCount() < 1) {\r\n            this.getAwardFun();\r\n            return;\r\n        } else {\r\n            FSDK.openVideo(\"spin\", () => {\r\n                this.getAwardFun();\r\n            }, this)\r\n        }\r\n\r\n    }\r\n\r\n    getAwardFun() {\r\n        this.closeNode.active = false;\r\n        this.isStart = true;\r\n\r\n        events.emit(GameEvents.PLAY_SOUND_EFFECT, AudioName.LUCK)\r\n\r\n        // 增加次数\r\n        let spinCount = user.getSpinCount();\r\n        spinCount += 1;\r\n        user.setSpinCount(spinCount);\r\n\r\n        let level = FSDK.getCreditDif();// 等级\r\n\r\n        let awardData = [\"\", 0, \"spin\", false, false];\r\n\r\n        let arrNum: number = utils.randomByWeight([0, 1, 2, 3, 4, 5], user.getLumpData().spinWeight[level]);// 要随机的数组\r\n\r\n        if (arrNum == Number(0)) {\r\n            let awardNum: any = FSDK.getCard(1);\r\n            awardData[0] = \"gp\";\r\n            if (awardNum.num <= 0) {\r\n                arrNum = 2;\r\n            } else {\r\n                awardData[1] = awardNum.num;\r\n            }\r\n        } else if (arrNum == Number(3)) {\r\n            let awardNum: any = FSDK.getCard(2);\r\n            awardData[0] = \"pp\";\r\n            if (awardNum.num <= 0) {\r\n                arrNum = 2;\r\n            } else {\r\n                awardData[1] = awardNum.num;\r\n            }\r\n        }\r\n\r\n        let rotationNum: number = 360 * 10 + (-arrNum * 60);\r\n        cc.tween(this.spinNode)\r\n            .by(4.2, { angle: rotationNum }, { easing: \"sineInOut\" })\r\n            .delay(.3)\r\n            .call(async () => {\r\n                this.isStart = false;\r\n                if (arrNum != Number(0) && arrNum != 3) {\r\n                    // 打开宝箱\r\n                    let iconPS = await GPool.get('creditPS');\r\n                    iconPS.parent = cc.find(\"Canvas\");\r\n\r\n                    FSDK.setCredit('credit', this._awardArr[arrNum].award, \"spin\");\r\n                    FSDK.showToast(`Congratulations on receiving ${this._awardArr[arrNum].award} gold coins`);\r\n\r\n                    events.emit(GameEvents.HIDE_POPUP);\r\n                    return;\r\n                }\r\n                events.emit(GameEvents.SHOW_POPUP, PopUpName.SUPERPRIZE, null, awardData);\r\n                events.emit(GameEvents.HIDE_POPUP);\r\n            })\r\n            .start()\r\n    }\r\n\r\n    closeHandle() {\r\n        if (this.isStart) {\r\n            FSDK.showToast('The spin is starting');\r\n            return;\r\n        }\r\n\r\n        if (!cc.sys.isNative || user.getLumpData().isDebug) {\r\n            events.emit(GameEvents.PLAY_SOUND_EFFECT, AudioName.BUTTON);\r\n            events.emit(GameEvents.HIDE_POPUP);\r\n            return;\r\n        }\r\n\r\n        events.emit(GameEvents.PLAY_SOUND_EFFECT, AudioName.BUTTON);\r\n        events.emit(GameEvents.HIDE_POPUP);\r\n    }\r\n\r\n}\r\n"]}