{"version":3,"sources":["assets\\script\\game\\Barrier.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { GameConstant, GameEvents } from \"../common/EventConstants\";\r\nimport { user } from \"../common/User\";\r\nimport { utils } from \"../common/Utils\";\r\nimport Ball from \"./Ball\";\r\nimport { events } from \"../common/Events\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n/**\r\n * 作者:Dandlly\r\n */\r\n@ccclass\r\nexport default class Barrier extends cc.Component {\r\n    @property(cc.Label)\r\n    lbScore: cc.Label = null;\r\n    @property()\r\n    isAddBuffBall: boolean = false;\r\n    @property()\r\n    isAddRed: boolean = false;\r\n    @property()\r\n    isBigBuffBall: boolean = false;\r\n    score: number = 0;\r\n\r\n    init(score = 0, isRain = false) {\r\n        if (this.lbScore) {\r\n            this.node.angle = 0;\r\n            this.lbScore.node.angle = 0;\r\n            let angleRan = -Math.random() * 360;\r\n            // 随机角度\r\n            this.node.angle = angleRan;\r\n            this.lbScore.node.color = cc.color().fromHEX(\"000000\");\r\n            this.lbScore.node.angle -= angleRan;\r\n        }\r\n\r\n        if (this.isAddRed) {\r\n            this.node.angle = 0;\r\n            this.lbScore.node.angle = 0;\r\n        }\r\n\r\n        if (score != 0) {\r\n            this.setScore(score);\r\n        } else {\r\n            if (!this.isAddBuffBall && !this.isAddRed && !this.isBigBuffBall) {\r\n                this.node.scale = utils.randomFloat(user.getLumpData().BarrierSacleArr);\r\n            }\r\n            this.setScore(GameConstant.game.setBarrierScore());\r\n        }\r\n\r\n        if (!this.isAddBuffBall && !this.isAddRed && !this.isBigBuffBall) {\r\n            if (isRain) {\r\n                this.node.getChildByName('IrisAnim').active = true;\r\n                this.node.getChildByName(\"rainbow\").active = true;\r\n            } else {\r\n                this.node.getChildByName('IrisAnim').active = false;\r\n                this.node.getChildByName(\"rainbow\").active = false;\r\n            }\r\n        }\r\n\r\n\r\n\r\n    }\r\n\r\n    //设置分数\r\n    setScore(score) {\r\n        if (this.lbScore) {\r\n            this.score = score;\r\n            this.lbScore.string = this.score.toString();\r\n            this.setColor(this.score);\r\n        }\r\n    }\r\n\r\n    getScore() {\r\n        return this.score;\r\n    }\r\n\r\n    setColor(scroe) {\r\n        if (this.isAddBuffBall || this.isAddRed || this.isBigBuffBall) return;\r\n        let colorData = user.getLumpData().color;\r\n        // 预防出错\r\n        if (colorData.length != 7) return;\r\n        let color;\r\n        if (scroe <= 10) {\r\n            color = colorData[0];\r\n        } else if (scroe <= 50) {\r\n            color = colorData[1];\r\n        } else if (scroe <= 100) {\r\n            color = colorData[2];\r\n        } else if (scroe <= 300) {\r\n            color = colorData[3];\r\n        } else if (scroe <= 500) {\r\n            color = colorData[4];\r\n        } else if (scroe <= 700) {\r\n            color = colorData[5];\r\n        } else if (scroe > 700) {\r\n            color = colorData[6];\r\n        }\r\n\r\n        for (let index = 0; index < this.node.children.length; index++) {\r\n            if (this.node.children[index].name.indexOf(\"bloacks_1\") != -1) {\r\n                this.node.children[index].color = cc.color().fromHEX(color[2]);\r\n            }\r\n            if (this.node.children[index].name.indexOf(\"bloacks_2\") != -1) {\r\n                this.node.children[index].color = cc.color().fromHEX(color[1]);\r\n            }\r\n            if (this.node.children[index].name.indexOf(\"bloacks_3\") != -1) {\r\n                this.node.children[index].color = cc.color().fromHEX(color[0]);\r\n            }\r\n        }\r\n    }\r\n\r\n    //发生碰撞时\r\n    onBeginContact(contact, selfCollider, otherCollider) {\r\n        if (otherCollider.tag == 1) {\r\n            // if (otherCollider.node.name == \"ball\") {\r\n            if (this.isAddBuffBall) {\r\n                GameConstant.game.addBall(this.node.position);\r\n                GameConstant.game.removeBarrier(this);\r\n                let _oldProp = user.getCurrentProp();\r\n                _oldProp -= 1;\r\n                user.setCurrentProp(_oldProp);\r\n            } else if (this.isBigBuffBall) {\r\n                if (otherCollider.node.getComponent(Ball).getHurt() == 2) return;\r\n                GameConstant.game.bigBall(otherCollider.node);\r\n                GameConstant.game.removeBarrier(this);\r\n                let _oldProp = user.getCurrentProp();\r\n                _oldProp -= 1;\r\n                user.setCurrentProp(_oldProp);\r\n            }\r\n            else if (this.isAddRed) {\r\n                let hurt = otherCollider.node.getComponent(Ball).getHurt();\r\n                if (this.score <= hurt) {\r\n                    GameConstant.game.addScore(this.score);\r\n                    this.node.opacity = 120;\r\n                    this.node.getComponent(cc.PhysicsPolygonCollider).enabled = false;\r\n                    this.score = 0;\r\n                    this.lbScore.node.active = false;\r\n                } else {\r\n                    this.setScore(this.score - hurt);\r\n                    GameConstant.game.addScore(this.score - hurt);\r\n                    GameConstant.game.shake(this.node);\r\n                }\r\n            } else {\r\n                let hurt = otherCollider.node.getComponent(Ball).getHurt();\r\n                if (this.score <= hurt) {\r\n                    GameConstant.game.addScore(this.score);\r\n                    GameConstant.game.removeBarrier(this);\r\n                } else {\r\n                    this.setScore(this.score - hurt);\r\n                    GameConstant.game.addScore(this.score - hurt);\r\n                    GameConstant.game.shake(this.node);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n"]}