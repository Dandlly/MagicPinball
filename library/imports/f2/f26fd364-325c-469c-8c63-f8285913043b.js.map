{"version":3,"sources":["assets\\FSDK_ASS\\FSript\\FNetWork\\FNetWorkCtrl.ts"],"names":[],"mappings":";;;;;;AAAA,mCAAkC;AAClC,uCAAsC;AACtC,6CAA4C;AAE5C;IAAA;IAuDA,CAAC;IAnDiB,wBAAW,GAAzB;QACI,IAAI,CAAC,YAAY,CAAC,SAAS,EAAE;YACzB,YAAY,CAAC,SAAS,GAAG,IAAI,YAAY,EAAE,CAAC;SAC/C;QACD,OAAO,YAAY,CAAC,SAAS,CAAC;IAClC,CAAC;IAED,IAAI;IACG,qCAAc,GAArB,UAAsB,EAAE,EAAC,MAAM;QAC3B,YAAY,CAAC,EAAE,GAAG,EAAE,CAAC;QACrB,YAAY,CAAC,MAAM,GAAG,MAAM,CAAC;QAC7B,eAAM,CAAC,WAAW,EAAE,CAAC,qBAAqB,EAAE,CAAC;QAC7C,IAAI,CAAC,iBAAO,CAAC,OAAO,EAAE;YAClB,iBAAO,CAAC,OAAO,GAAG,IAAI,mBAAQ,EAAE,CAAC;YACjC,eAAM,CAAC,WAAW,EAAE,CAAC,kBAAkB,EAAE,CAAC;SAC7C;QAAA,CAAC;QACF,IAAI,IAAI,GAAG;YACP,IAAI,EAAE,cAAc,CAAC,WAAW,EAAE;YAClC,IAAI,EAAE,cAAc,CAAC,WAAW;SACnC,CAAC;QACF,iBAAO,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,EAAE,EAAE,EAAC,MAAM,CAAC,CAAC;QACrC,iBAAO,CAAC,OAAO,CAAC,EAAE,CAAC,QAAQ,CAAC,WAAW,EAAE;YACrC,iBAAO,CAAC,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC;YAC1C,iBAAO,CAAC,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC;YAC7C,YAAY,CAAC,WAAW,EAAE,CAAC,UAAU,EAAE,CAAC;QAC5C,CAAC,CAAC,CAAC;QACH,iBAAO,CAAC,OAAO,CAAC,EAAE,CAAC,QAAQ,CAAC,cAAc,EAAE;YACxC,iBAAO,CAAC,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC;YAC7C,iBAAO,CAAC,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC;YAC1C,YAAY,CAAC,WAAW,EAAE,CAAC,UAAU,EAAE,CAAC;QAC5C,CAAC,CAAC,CAAC;IACP,CAAC;IAED;;OAEG;IACI,iCAAU,GAAjB;QAAA,iBAaC;QAZG,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC;QAC7B,OAAO,CAAC,KAAK,CAAC,YAAY,CAAC,CAAA;QAC3B,UAAU,CAAC;YACP,iBAAO,CAAC,OAAO,CAAC,YAAY,EAAE,CAAC;YAC/B,iBAAO,CAAC,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC;YAC1C,iBAAO,CAAC,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC;YAC7C,iBAAO,CAAC,OAAO,GAAG,IAAI,CAAC;YACvB,IAAI,IAAI,GAAG,eAAM,CAAC,WAAW,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC;YAC/D,YAAY,CAAC,WAAW,EAAE,CAAC,cAAc,CAAC;gBACtC,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,MAAM,EAAE,cAAc,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;YAC1F,CAAC,EAAE,KAAI,CAAC,CAAA;QACZ,CAAC,EAAE,IAAI,CAAC,CAAC;IACb,CAAC;IAnDa,eAAE,GAAG,IAAI,CAAC;IACV,mBAAM,GAAG,IAAI,CAAC;IAoDhC,mBAAC;CAvDD,AAuDC,IAAA;AAvDY,oCAAY","file":"","sourceRoot":"/","sourcesContent":["import { FLogic } from \"./FLogic\";\r\nimport { FNetWork } from \"./FNetWork\";\r\nimport { FGlobal } from \"../FModel/FGlobal\";\r\n\r\nexport class FNetWorkCtrl {\r\n    public static _instance: FNetWorkCtrl;\r\n    public static cb = null;\r\n    public static target = null;\r\n    public static getInstance() {\r\n        if (!FNetWorkCtrl._instance) {\r\n            FNetWorkCtrl._instance = new FNetWorkCtrl();\r\n        }\r\n        return FNetWorkCtrl._instance;\r\n    }\r\n\r\n    //链接\r\n    public ConnetctServer(cb,target) {\r\n        FNetWorkCtrl.cb = cb;\r\n        FNetWorkCtrl.target = target;\r\n        FLogic.getInstance().removeCommonListenser();\r\n        if (!FGlobal.NetWork) {\r\n            FGlobal.NetWork = new FNetWork();\r\n            FLogic.getInstance().addCommonListenser();\r\n        };\r\n        let parm = {\r\n            host: FNetWorkConfig.getServerIp(),\r\n            port: FNetWorkConfig.server_port\r\n        };\r\n        FGlobal.NetWork.int(parm, cb,target);\r\n        FGlobal.NetWork.on(FEventID.EVENT_CLOSE, function () {\r\n            FGlobal.NetWork.off(FEventID.EVENT_CLOSE);\r\n            FGlobal.NetWork.off(FEventID.EVENT_IO_ERROR);\r\n            FNetWorkCtrl.getInstance().onDropLine();\r\n        });\r\n        FGlobal.NetWork.on(FEventID.EVENT_IO_ERROR, function () {\r\n            FGlobal.NetWork.off(FEventID.EVENT_IO_ERROR);\r\n            FGlobal.NetWork.off(FEventID.EVENT_CLOSE);\r\n            FNetWorkCtrl.getInstance().onDropLine();\r\n        });\r\n    }\r\n\r\n    /** \r\n     * 当掉线或者是准备重连时\r\n     */\r\n    public onDropLine() {\r\n        FSDK.showToLoad(\"Rebinding\");\r\n        console.error(\"这个是close监听\")\r\n        setTimeout(() => {\r\n            FGlobal.NetWork.clearAllTime();\r\n            FGlobal.NetWork.off(FEventID.EVENT_CLOSE);\r\n            FGlobal.NetWork.off(FEventID.EVENT_IO_ERROR);\r\n            FGlobal.NetWork = null;\r\n            let data = FLogic.getInstance().cbList[FEventID.S2C_reg_login];\r\n            FNetWorkCtrl.getInstance().ConnetctServer(function () {\r\n                FSDK.login(FNetWorkConfig.data.pg, data.cb, data.target, FNetWorkConfig.data.test_aid)\r\n            }, this)\r\n        }, 3000);\r\n    }\r\n\r\n}"]}